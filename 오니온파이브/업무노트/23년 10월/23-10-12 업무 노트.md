#오니온파이브 #업무노트


## 알아볼것들


## 학습 내용
[[MVT 패턴]]

## 정보
- aws 공부
- 쿠버네티스 공부
- celery 공부
- 

### 미팅 내용
- 개발망 제외 스테이징 환경이 있음
- 스테이징 환경(라이브랑 비슷한 환경)에서 테스트 후 라이브로 올리는 식으로 진행
- 스테이징은 쿠버네티스 사용 중
	- 노드라는 쿠버네티스에서 쓰는 컴퓨팅 자원
- oq1-xxx로 네이밍 되는건 오큐톡 관련 노드
- oqupie-xxx 네이밍은 현재 오큐파이 서비스 중인 노드
- celery는 비동기 백그라운드 실행 가능 해주게 하는 툴
	- beat는 크론 탭을 사용해서, 배치 작업 돌아가게 해주는거라 생각
- 티켓 상세 페이지에 접속한 사람이 몇명인지 알기 위해 웹 소켓을 사용 중
- redis서버는 오큐톡에서 쓰던 건데, 거의 쓸일 없을 듯
- stg-xxxx는 v3라고 새롭게 하는 서비스
	- msa 방식을 취하려고 기능별로 서비스를 분리함
- osix-xxx는 어드민 관련 툴
- stg-survey는 고객만족도 설문조사에 대한 페이지
- stg-webserver는 프론트 페이지 서빙을 위한 서버
- aws 쿠버네티스 eks 사용 중
- 쿠버네티스 ingress
- 배포시, 도커 파일로(ECR) 배포함
	- 스테이징 쪽으로 PR을 날리면 도커 이미지가 ECR로 날라감
	- 깃허브에서 스테이징으로 머지 성공하면, 깃헙 액션으로 이미지 자동 빌드해서 ECR에 올리고 사용자가 쿠버네티스 명령어를 통해 재시작하면, 최신 이미지로 재시작 되는 식으로 작동
- celery broker라는 걸로 캐시 서버로 씀
- redis는 거의 세션 서버로 사용
- 포탈 파인더라는 것은 end-user 로그인이라고 새악하는게 좋을 듯
	- 포탈파인더는 복잡해서 개선을 해야할 부분이긴 함
- RDS는 Bastion Host를 통해서만 접근 가능하도록 함
	- 이렇게 한 이유는, 보안 이슈상 누가 개발 포트를 뚫으면 DB도 들어올 수도 있으니
	  Bastion만 보안적으로 관리하면 되니 이렇게 사용 중
  - 라이브 환경은 ECS에서 쿠버네티스로 바꾸는 중이라 파편화가 생김
	  - 만약 쿠버네티스에 없는건 ECS에 있다 생각
  - smtp, imap등등 다시 ㅇ라아보기
  - 보통 작업하면 celery-worker랑 beat작업을 주로 하게 될 듯
  - oqupie-source 레포만 자동으로 이미지를 안만들어줌
	  - codepipeline을 통해 배포 진행됨
  - DNS는 oqupie.com(스테이징 도메인주소랑 같음), oqupie-internal(레플리카용)
  - onionsix는 FARGATE 사용 중
	  - 비관리형 컴퓨팅 자원이라 생각
	  - FARGATE 알아보기
  - EC2에 없으면 FARGATE라는걸로 사용중
  - 라이브 환경 부터는 encrypted적힌 건 RW(ReadWrite)
	  - replica는 READ만 가능
  - 베타가 사용빈도가 적고 거의 안쓴다면 내리는 방향으로 고민중이심
  - 라이브 서버에서는 aws lambda를 사용해서, 알림이라던지 여러가지를 보내는 중
	  - 로그인을 하면, cloudwatch를 이용해서 slack으로 쓰는 등의 일을 함
	  - 컨플루언스 위키에 aws 알림 보면 조금 정리되어 있음
  - AWS KMS 사용
	  - 환경 변수 관리할때, 스테이징은 SSM사용
	  - key-value불러 오는 형식
	  - 라이브는 KMS를 통해, 암호화 해서 s3에 저장해서 사용
	  - osix에 암호화 하는 로직이 있을거임
  - S3 접근 시, 자격증명이 필요한데 개발 환경에서는 IAM 역할을 열어둠
	  - 컴퓨팅 자원에다 역할을 주면 credential 인증 안하고도 바로 s3 접근이 가능
  - 새로운 프로젝트 시작시에는, 서비스랑 저장소 레이어까지 나눠보실려고 고민중이심
  


## 무얼했는가?

- [x] 파이썬 책을 통한 학습 ✅ 2023-10-12
	- [x] 배포 까지 진행했으나, 이제 db연결 진행해야댐 ✅ 2023-10-12
- [ ] 챕터 8부터 이어서 진행

